<!-- Navigation -->
	
	<!-- Background Gradients-->
	<div  class="site-gradients">
		<div class="site-gradients-media">
			<figure>
				<img src="Another%20Yosemite%20short%20movie%20project%20%E2%80%93%20Modern_files/PcLGXNjMTdiFVKTrElCl__DSC2245.jpg" alt="PcLGXNjMTdiFVKTrElCl__DSC2245" srcset="https://themedemos.webmandesign.eu/modern/wp-content/uploads/sites/8/2014/11/PcLGXNjMTdiFVKTrElCl__DSC2245.jpg 1920w, https://themedemos.webmandesign.eu/modern/wp-content/uploads/sites/8/2014/11/PcLGXNjMTdiFVKTrElCl__DSC2245-420x280.jpg 420w, https://themedemos.webmandesign.eu/modern/wp-content/uploads/sites/8/2014/11/PcLGXNjMTdiFVKTrElCl__DSC2245-744x497.jpg 744w, https://themedemos.webmandesign.eu/modern/wp-content/uploads/sites/8/2014/11/PcLGXNjMTdiFVKTrElCl__DSC2245-1200x801.jpg 1200w" sizes="(max-width: 1617px) 100vw, 1617px" height="1080" width="1617">
			</figure>
		</div>
	</div>

	<header class="container">
		<div class="site-branding">
			<h1 class="site-title">
				<a href="/index/index">
					<span>Justice</span>
				</a>
			</h1>
			<h2 class="site-description">Welcome to Us !</h2>
		</div>
	</header>
	
	<!-- /////////////////////////////////////////Content -->
	<div id="page-content" class="single-page">
		<div class="container">
			<div class="row">
				<div id="main-content">
					<article>
						<img src="/images/banner1.jpg" />
						<div class="art-content">
							<h1>支付宝网页授权获取用户信息</h1>
							<div class="info">By <a href="#">夕夜</a> 10 20, 2017 </div>
                            <p>1. 支付宝生活号申请，申请完成后上传&nbsp;<span style="color: rgb(128, 128, 128); font-family: tahoma, arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft Yahei&quot;, 宋体; font-size: 12px; white-space: normal; background-color: rgb(244, 245, 249);">RSA2(SHA256)密钥</span></p><p>2. &nbsp;URL拼接与scope详解 &nbsp;<span style="white-space: normal;">获取auth_code</span> &nbsp;（支付宝授权）<br></p><p>接口URL为：<span style="color: rgb(221, 17, 68); font-family: &quot;Microsoft Yahei&quot;, 微软雅黑, Arial; font-size: 14px; white-space: pre-wrap; background-color: rgb(247, 247, 249);">https://openauth.alipay.com/oauth2/publicAppAuthorize.htm?app_id=APPID&amp;scope=SCOPE&amp;redirect_uri=ENCODED_URL</span></p><p><span style="color: rgb(221, 17, 68); font-family: &quot;Microsoft Yahei&quot;, 微软雅黑, Arial; font-size: 14px; white-space: pre-wrap; background-color: rgb(247, 247, 249);"></span></p><pre style="background-color:#2b2b2b;color:#aeb5bd;font-family:'宋体';font-size:9.6pt;"><span style="color:#7a7a7a;background-color:#232525;font-style:italic;">/**<br></span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;"> * 网页授权获取支付宝code<br></span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;"> * </span><span style="color:#7a7a7a;background-color:#232525;font-weight:bold;font-style:italic;">@param </span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;">$redirecturl<br></span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;"> * </span><span style="color:#7a7a7a;background-color:#232525;font-weight:bold;font-style:italic;">@param </span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;">string $scope<br></span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;"> */<br></span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">public function </span><span style="color:#d9af6c;background-color:#232525;">get_ali_code</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$redirecturl</span><span style="color:#5c7ab8;background-color:#232525;">,</span><span style="color:#9876aa;background-color:#232525;">$scope</span><span style="background-color:#232525;">=</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'auth_userinfo'</span><span style="background-color:#232525;">){<br></span><span style="background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$appid </span><span style="background-color:#232525;">= </span><span style="color:#a9b7c6;background-color:#232525;">Yii</span><span style="background-color:#232525;">::</span><span style="color:#828eba;background-color:#232525;font-style:italic;">$app</span><span style="background-color:#232525;">-&gt;</span><span style="color:#828eba;background-color:#232525;">params</span><span style="background-color:#232525;">[</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'ali_appid'</span><span style="background-color:#232525;">]</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$redirect_uri </span><span style="background-color:#232525;">= </span><span style="color:#a9b7c6;background-color:#232525;">urlencode</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$redirecturl</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$state </span><span style="background-color:#232525;">= </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'ascd'</span><span style="background-color:#232525;">.</span><span style="color:#a9b7c6;background-color:#232525;">rand</span><span style="background-color:#232525;">(</span><span style="color:#267dff;background-color:#232525;">0</span><span style="color:#5c7ab8;background-color:#232525;">,</span><span style="color:#267dff;background-color:#232525;">10</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$url </span><span style="background-color:#232525;">= </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"https://openauth.alipay.com/oauth2/publicAppAuthorize.htm?app_id="</span><span style="background-color:#232525;">.</span><span style="color:#9876aa;background-color:#232525;">$appid</span><span style="background-color:#232525;">.</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"&amp;redirect_uri=</span><span style="background-color:#232525;">{</span><span style="color:#9876aa;background-color:#232525;">$redirect_uri</span><span style="background-color:#232525;">}</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">&amp;scope=</span><span style="background-color:#232525;">{</span><span style="color:#9876aa;background-color:#232525;">$scope</span><span style="background-color:#232525;">}</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">&amp;state=</span><span style="background-color:#232525;">{</span><span style="color:#9876aa;background-color:#232525;">$state</span><span style="background-color:#232525;">}</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#a9b7c6;background-color:#232525;">header</span><span style="background-color:#232525;">(</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"location:"</span><span style="background-color:#232525;">.</span><span style="color:#9876aa;background-color:#232525;">$url</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">exit</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="background-color:#232525;">}</span></pre><p><span style="color: rgb(221, 17, 68); font-family: &quot;Microsoft Yahei&quot;, 微软雅黑, Arial; font-size: 14px; white-space: pre-wrap; background-color: rgb(247, 247, 249);"></span>&nbsp;跳转回来后直接通过get方式获取即可</p><p>3.获取用户信息</p><p>接口地址为：<code class="java plain" style="font-size: 14px; white-space: pre-wrap; font-variant-numeric: inherit; font-stretch: inherit; word-break: break-all; word-wrap: break-word; margin: 0px !important; padding: 0px !important; font-family: &quot;Microsoft Yahei&quot;, 微软雅黑, Arial !important; color: rgb(0, 0, 0) !important; border-radius: 0px !important; background: none !important; border: 0px !important; line-height: 1.1em !important; vertical-align: baseline !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; min-height: auto !important;">https:</code><code class="java comments" style="font-size: 14px; white-space: pre-wrap; font-variant-numeric: inherit; font-stretch: inherit; word-break: break-all; word-wrap: break-word; margin: 0px !important; padding: 0px !important; font-family: &quot;Microsoft Yahei&quot;, 微软雅黑, Arial !important; color: rgb(0, 130, 0) !important; border-radius: 0px !important; background: none !important; border: 0px !important; line-height: 1.1em !important; vertical-align: baseline !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; min-height: auto !important;">//openapi.alipay.com/gateway.do</code></p><p><code class="java comments" style="font-size: 14px; white-space: pre-wrap; font-variant-numeric: inherit; font-stretch: inherit; word-break: break-all; word-wrap: break-word; margin: 0px !important; padding: 0px !important; font-family: &quot;Microsoft Yahei&quot;, 微软雅黑, Arial !important; color: rgb(0, 130, 0) !important; border-radius: 0px !important; background: none !important; border: 0px !important; line-height: 1.1em !important; vertical-align: baseline !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; min-height: auto !important;"></code></p><pre style="background-color:#2b2b2b;color:#aeb5bd;font-family:'宋体';font-size:9.6pt;"><span style="color:#7a7a7a;background-color:#232525;font-style:italic;">/**<br></span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;"> * 支付宝获取用户ID<br></span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;"> * </span><span style="color:#7a7a7a;background-color:#232525;font-weight:bold;font-style:italic;">@param </span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;">$auth_code<br></span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;"> * </span><span style="color:#7a7a7a;background-color:#232525;font-weight:bold;font-style:italic;">@return </span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;">mixed<br></span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;"> */<br></span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">public function </span><span style="color:#d9af6c;background-color:#232525;">get_userid</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$auth_code</span><span style="background-color:#232525;">){<br></span><span style="background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$http_query </span><span style="background-color:#232525;">= </span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">array</span><span style="background-color:#232525;">(<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'app_id' </span><span style="background-color:#232525;">=&gt; </span><span style="color:#a9b7c6;background-color:#232525;">Yii</span><span style="background-color:#232525;">::</span><span style="color:#828eba;background-color:#232525;font-style:italic;">$app</span><span style="background-color:#232525;">-&gt;</span><span style="color:#828eba;background-color:#232525;">params</span><span style="background-color:#232525;">[</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'ali_appid'</span><span style="background-color:#232525;">]</span><span style="color:#5c7ab8;background-color:#232525;">,<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'method' </span><span style="background-color:#232525;">=&gt; </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'alipay.system.oauth.token'</span><span style="color:#5c7ab8;background-color:#232525;">,<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'charset'</span><span style="background-color:#232525;">=&gt; </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'UTF-8'</span><span style="color:#5c7ab8;background-color:#232525;">,<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'sign_type'</span><span style="background-color:#232525;">=&gt;</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'RSA2'</span><span style="color:#5c7ab8;background-color:#232525;">,<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'timestamp'</span><span style="background-color:#232525;">=&gt;</span><span style="color:#a9b7c6;background-color:#232525;">date</span><span style="background-color:#232525;">(</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'Y-m-d H:i:s'</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">,<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'version'</span><span style="background-color:#232525;">=&gt; </span><span style="color:#267dff;background-color:#232525;">1.0</span><span style="color:#5c7ab8;background-color:#232525;">,<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'grant_type'</span><span style="background-color:#232525;">=&gt;</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'authorization_code'</span><span style="color:#5c7ab8;background-color:#232525;">,<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'code'</span><span style="background-color:#232525;">=&gt;</span><span style="color:#9876aa;background-color:#232525;">$auth_code<br></span><span style="color:#9876aa;background-color:#232525;"> &nbsp; &nbsp;</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$common </span><span style="background-color:#232525;">= </span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">new </span><span style="color:#a9b7c6;background-color:#232525;">Common</span><span style="background-color:#232525;">()</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$http_query</span><span style="background-color:#232525;">[</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'sign'</span><span style="background-color:#232525;">] = </span><span style="color:#9876aa;background-color:#232525;">$common</span><span style="background-color:#232525;">-&gt;</span><span style="color:#d9af6c;background-color:#232525;">rsaSign</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$http_query</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$respon </span><span style="background-color:#232525;">=</span><span style="color:#9876aa;background-color:#232525;">$this</span><span style="background-color:#232525;">-&gt;</span><span style="color:#d9af6c;background-color:#232525;">curl_https</span><span style="background-color:#232525;">(</span><span style="color:#a9b7c6;background-color:#232525;">Yii</span><span style="background-color:#232525;">::</span><span style="color:#828eba;background-color:#232525;font-style:italic;">$app</span><span style="background-color:#232525;">-&gt;</span><span style="color:#828eba;background-color:#232525;">params</span><span style="background-color:#232525;">[</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'ali_gateway_url'</span><span style="background-color:#232525;">]</span><span style="color:#5c7ab8;background-color:#232525;">,</span><span style="color:#9876aa;background-color:#232525;">$http_query</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">return </span><span style="color:#9876aa;background-color:#232525;">$respon</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="background-color:#232525;">}</span></pre><p><code class="java comments" style="font-size: 14px; white-space: pre-wrap; font-variant-numeric: inherit; font-stretch: inherit; word-break: break-all; word-wrap: break-word; margin: 0px !important; padding: 0px !important; font-family: &quot;Microsoft Yahei&quot;, 微软雅黑, Arial !important; color: rgb(0, 130, 0) !important; border-radius: 0px !important; background: none !important; border: 0px !important; line-height: 1.1em !important; vertical-align: baseline !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; outline: 0px !important; overflow: visible !important; position: static !important; right: auto !important; top: auto !important; width: auto !important; box-sizing: content-box !important; min-height: auto !important;"></code>获取签名方法：</p><pre style="background-color:#2b2b2b;color:#aeb5bd;font-family:'宋体';font-size:9.6pt;"><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">public function </span><span style="color:#d9af6c;background-color:#232525;">rsaSign</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$params</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;">$signType </span><span style="background-color:#232525;">= </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"RSA2"</span><span style="background-color:#232525;">) {<br></span><span style="background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">return </span><span style="color:#9876aa;background-color:#232525;">$this</span><span style="background-color:#232525;">-&gt;</span><span style="color:#d9af6c;background-color:#232525;">sign</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$this</span><span style="background-color:#232525;">-&gt;</span><span style="color:#d9af6c;background-color:#232525;">getSignContent</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$params</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;">$signType</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="background-color:#232525;">}<br></span><span style="background-color:#232525;"><br></span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">protected function </span><span style="color:#d9af6c;background-color:#232525;">getSignContent</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$params</span><span style="background-color:#232525;">) {<br></span><span style="background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#a9b7c6;background-color:#232525;">ksort</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$params</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$stringToBeSigned </span><span style="background-color:#232525;">= </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">""</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$i </span><span style="background-color:#232525;">= </span><span style="color:#267dff;background-color:#232525;">0</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">foreach </span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$params </span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">as </span><span style="color:#9876aa;background-color:#232525;">$k </span><span style="background-color:#232525;">=&gt; </span><span style="color:#9876aa;background-color:#232525;">$v</span><span style="background-color:#232525;">) {<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">if </span><span style="background-color:#232525;">(</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">false </span><span style="background-color:#232525;">=== </span><span style="color:#9876aa;background-color:#232525;">$this</span><span style="background-color:#232525;">-&gt;</span><span style="color:#d9af6c;background-color:#232525;">checkEmpty</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$v</span><span style="background-color:#232525;">) &amp;&amp; </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"@" </span><span style="background-color:#232525;">!= </span><span style="color:#a9b7c6;background-color:#232525;">substr</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$v</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#267dff;background-color:#232525;">0</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#267dff;background-color:#232525;">1</span><span style="background-color:#232525;">)) {<br></span><span style="background-color:#232525;"><br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#7a7a7a;background-color:#232525;">// 转换成目标字符集<br></span><span style="color:#7a7a7a;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$v </span><span style="background-color:#232525;">= </span><span style="color:#9876aa;background-color:#232525;">$this</span><span style="background-color:#232525;">-&gt;</span><span style="color:#d9af6c;background-color:#232525;">characet</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$v</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;">$this</span><span style="background-color:#232525;">-&gt;</span><span style="color:#828eba;background-color:#232525;">postCharset</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"><br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">if </span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$i </span><span style="background-color:#232525;">== </span><span style="color:#267dff;background-color:#232525;">0</span><span style="background-color:#232525;">) {<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$stringToBeSigned </span><span style="background-color:#232525;">.= </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"</span><span style="color:#9876aa;background-color:#232525;">$k</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">" </span><span style="background-color:#232525;">. </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"=" </span><span style="background-color:#232525;">. </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"</span><span style="color:#9876aa;background-color:#232525;">$v</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#232525;">} </span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">else </span><span style="background-color:#232525;">{<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$stringToBeSigned </span><span style="background-color:#232525;">.= </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"&amp;" </span><span style="background-color:#232525;">. </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"</span><span style="color:#9876aa;background-color:#232525;">$k</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">" </span><span style="background-color:#232525;">. </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"=" </span><span style="background-color:#232525;">. </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"</span><span style="color:#9876aa;background-color:#232525;">$v</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#232525;">}<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$i</span><span style="background-color:#232525;">++</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="background-color:#232525;">}<br></span><span style="background-color:#232525;"> &nbsp; &nbsp;}<br></span><span style="background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">unset </span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$k</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;">$v</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">return </span><span style="color:#9876aa;background-color:#232525;">$stringToBeSigned</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="background-color:#232525;">}<br></span><span style="background-color:#232525;"><br></span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;">/**<br></span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;"> * 校验$value是否非空<br></span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;"> * &nbsp;if not set ,return true;<br></span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;"> * &nbsp; &nbsp;if is null , return true;<br></span><span style="color:#7a7a7a;background-color:#232525;font-style:italic;"> **/<br></span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">protected function </span><span style="color:#d9af6c;background-color:#232525;">checkEmpty</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$value</span><span style="background-color:#232525;">) {<br></span><span style="background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">if </span><span style="background-color:#232525;">(!</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">isset</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$value</span><span style="background-color:#232525;">))<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">return true</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">if </span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$value </span><span style="background-color:#232525;">=== </span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">null</span><span style="background-color:#232525;">)<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">return true</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">if </span><span style="background-color:#232525;">(</span><span style="color:#a9b7c6;background-color:#232525;">trim</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$value</span><span style="background-color:#232525;">) === </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">""</span><span style="background-color:#232525;">)<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">return true</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"><br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">return false</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="background-color:#232525;">}<br></span><span style="background-color:#232525;"><br></span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">protected function </span><span style="color:#d9af6c;background-color:#232525;">sign</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$data</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;">$signType </span><span style="background-color:#232525;">= </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"RSA2"</span><span style="background-color:#232525;">) {<br></span><span style="background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">if</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$this</span><span style="background-color:#232525;">-&gt;</span><span style="color:#d9af6c;background-color:#232525;">checkEmpty</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$this</span><span style="background-color:#232525;">-&gt;</span><span style="color:#828eba;background-color:#232525;">rsaPrivateKeyFilePath</span><span style="background-color:#232525;">)){<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$priKey</span><span style="background-color:#232525;">=</span><span style="color:#9876aa;background-color:#232525;">$this</span><span style="background-color:#232525;">-&gt;</span><span style="color:#828eba;background-color:#232525;">rsaPrivateKey</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$res </span><span style="background-color:#232525;">= </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"-----BEGIN RSA PRIVATE KEY-----</span><span style="color:#5c7ab8;background-color:#232525;">\n</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">" </span><span style="background-color:#232525;">.<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#a9b7c6;background-color:#232525;">wordwrap</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$priKey</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#267dff;background-color:#232525;">64</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"</span><span style="color:#5c7ab8;background-color:#232525;">\n</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">true</span><span style="background-color:#232525;">) .<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"</span><span style="color:#5c7ab8;background-color:#232525;">\n</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">-----END RSA PRIVATE KEY-----"</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="background-color:#232525;">}</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">else </span><span style="background-color:#232525;">{<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$priKey </span><span style="background-color:#232525;">= </span><span style="color:#a9b7c6;background-color:#232525;">file_get_contents</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$this</span><span style="background-color:#232525;">-&gt;</span><span style="color:#828eba;background-color:#232525;">rsaPrivateKeyFilePath</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$res </span><span style="background-color:#232525;">= </span><span style="color:#a9b7c6;background-color:#232525;">openssl_get_privatekey</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$priKey</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="background-color:#232525;">}<br></span><span style="background-color:#232525;"> &nbsp; &nbsp;(</span><span style="color:#9876aa;background-color:#232525;">$res</span><span style="background-color:#232525;">) </span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">or die</span><span style="background-color:#232525;">(</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">'您使用的私钥格式错误，请检查RSA私钥配置'</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"><br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">if </span><span style="background-color:#232525;">(</span><span style="color:#807d6e;background-color:#232525;font-weight:bold;">"RSA2" </span><span style="background-color:#232525;">== </span><span style="color:#9876aa;background-color:#232525;">$signType</span><span style="background-color:#232525;">) {<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#a9b7c6;background-color:#232525;">openssl_sign</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$data</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;">$sign</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;">$res</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;font-style:italic;">OPENSSL_ALGO_SHA256</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="background-color:#232525;">} </span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">else </span><span style="background-color:#232525;">{<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#a9b7c6;background-color:#232525;">openssl_sign</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$data</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;">$sign</span><span style="color:#5c7ab8;background-color:#232525;">, </span><span style="color:#9876aa;background-color:#232525;">$res</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="background-color:#232525;">}<br></span><span style="background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">if</span><span style="background-color:#232525;">(!</span><span style="color:#9876aa;background-color:#232525;">$this</span><span style="background-color:#232525;">-&gt;</span><span style="color:#d9af6c;background-color:#232525;">checkEmpty</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$this</span><span style="background-color:#232525;">-&gt;</span><span style="color:#828eba;background-color:#232525;">rsaPrivateKeyFilePath</span><span style="background-color:#232525;">)){<br></span><span style="background-color:#232525;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color:#a9b7c6;background-color:#232525;">openssl_free_key</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$res</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="background-color:#232525;">}<br></span><span style="background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#9876aa;background-color:#232525;">$sign </span><span style="background-color:#232525;">= </span><span style="color:#a9b7c6;background-color:#232525;">base64_encode</span><span style="background-color:#232525;">(</span><span style="color:#9876aa;background-color:#232525;">$sign</span><span style="background-color:#232525;">)</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="color:#5c7ab8;background-color:#232525;"> &nbsp; &nbsp;</span><span style="color:#5c7ab8;background-color:#232525;font-weight:bold;">return </span><span style="color:#9876aa;background-color:#232525;">$sign</span><span style="color:#5c7ab8;background-color:#232525;">;<br></span><span style="background-color:#232525;">}</span></pre><p>其中属性 $rsaPrivateKey就是第一步设置的RAS2私钥</p>
						</div>
					</article>
					<div class="widget wid-related">
						<div class="heading"><h4>Related Post</h4></div>
						<div class="content">
							<div class="row">
								<div class="col-md-4">
									<div class="wrap-col">
										<a href="#"><img src="/images/7.jpg" /></a>
										<h4><a href="#">Vero eros et accumsan et iusto odio </a></h4>
									</div>
								</div>
								<div class="col-md-4">
									<div class="wrap-col">
										<a href="#"><img src="/images/8.jpg" /></a>
										<h4><a href="#">Vero eros et accumsan et iusto odio </a></h4>
									</div>
								</div>
								<div class="col-md-4">
									<div class="wrap-col">
										<a href="#"><img src="/images/6.jpg" /></a>
										<h4><a href="#">Vero eros et accumsan et iusto odio </a></h4>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
	</div>